<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinkr</title>

    <%-include('../header');  -%>

            <!-- content -->
            <div class="container-fluid">

                <!-- charts -->
                <div class="col-lg-12 pl-lg-0 mt-2">
                    <h4 class="primary">View All Patients</h4>
                </div>
                <div class="chart">
                    <div class="row">
                        <div class="col-4 mb-3 mb-3">
                            <div class="form-group"><label class="input__label">Search</label><input type="text" id="searchBox" class="form-control input-style" placeholder=""></div>
                          </div>
                        <div class="col-lg-12 pl-lg-3 chart-grid mt-1">
                            <!--part 1-->
                            <div class="card card_border">
									<table class="table2" id="tblid">
									<tr>
									
									<th>Code</th>
									<th>Name</th>
									<th>Gender</th>
									<th>Mobile</th>
									<th>Email</th>
									<th >View</th>
									</tr>
                                    <tbody id="tbodyid">

                                    </tbody>
									
									</table>
                                </div>
                                    <div id="paginationControls"></div>

                                
                            </div>
                          
                        </div>
                       
                    </div>
                  
                </div>
                <!-- //charts -->
                 
                 
            </div>
            


            <%-include('../footer');  -%>
            <script >


                $(document).ready(function() {

         
                // Function to fetch and display data
                function fetchData() {
                  $.ajax({
                    url: '/getPatients',
                    type: 'GET',
                    success: function(data) {
                        console.log(data)
                      let tableRows = '';
                      
                      data.forEach(function(item) {
                          
                        tableRows += `
                          <tr data-bbm-id="${item.id}">
        
        <td>${item.code}</td>
        <td>${item.name}</td>
        <td>${item.gender}</td>
        <td>${item.mobile}</td>
        <td>${item.email}</td>
        <td>
          <button type="button" id="emr_btn" class="btn btn-primary btn-style btn-change mr-2">EMR</button>
          <a href="#" id="360_id" class="btn btn-primary btn-style btn-change">360</a>
        </td>
      </tr>
                        `;
                      });
                    
                      $('#tbodyid').html(tableRows);
                      pagi_search('#searchBox','#tblid','#paginationControls')
                      $('#tblid').on('click', '#emr_btn', function() {
                        const id=$(this).closest('tr').data('bbm-id')
                        const route='patient-emr'
                          ViewBtn(route,id)
                         });
                         $('#tblid').on('click', '#360_id', function() {
                        const id=$(this).closest('tr').data('bbm-id')
                        const route='patient360'
                          ViewBtn(route,id)
                         });
                         
                         
                    },
                    error: function(xhr, status, error) {
                      console.error('Error fetching classification details:', error);
                    }
                  });
                }
              
                // Fetch data on page load
                fetchData();
              });
              
              </script>