<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LifeLinkr</title>

   <%- include('../header') -%>
    


            <!-- content -->
            <div class="container-fluid">

                <!-- charts -->
                <div class="col-lg-12 pl-lg-0 mt-2">
                    <h4 class="primary">Add Staff</h4>
                </div>
                <div class="chart">
                    <div class="row">

                        <div class="col-lg-12 pl-lg-2 chart-grid mt-1">
                            <!--part 1-->
                            <div class="card card_border">
                                <div class="">
                                    <div class="col-xl-12 pr-xl-2 p-heading">
                                        <h6 class="p-text">Add Staff</h6>
                                    </div>

                                    <div class="col-xl-12 pr-xl-2 mb-4">
                                        <form id="staffForm" class="mt-2">
                                            <input type="hidden" name="query" id="query" value="0">
                                            <div id="errordiv"></div>
                                            <div class="row">
                                                <div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Code*</label>
                                                        <input type="text" class="form-control input-style"
                                                            id="code" name="code" data-validation="required" data-error-message="Code is required"
                                                            placeholder="">
                                                    </div>
                                                </div>
                                                <div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Clinic*</label>
                                                        <select class="form-control input-style" id="clinicid" name="clinicid" data-validation="required" data-error-message="clinic is required">
                                                       <option value=""></option>

                                                        </select>
                                                    </div>
                                                </div>
												
												<div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Name*</label>
                                                        <input type="text" class="form-control input-style"
                                                        id="name" name="name" data-validation="required" data-error-message="Patient Name is required"
                                                        placeholder="">
                                                    </div>
                                                </div>
												
												
												<div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Email*</label>
                                                        <input type="email" class="form-control input-style"
                                                        id="email" name="email" aria-describedby="emailHelp"  data-validation="required" data-error-message="Email is required"
                                                        placeholder="">
                                                    </div>
                                                </div>
												
												<div class="col-xl-3 col-xs-6">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Mobile No*</label>
                                                        <input type="number" class="form-control input-style"
                                                        id="mobile" name="mobile" aria-describedby="emailHelp" data-validation="required mobileNum"  data-validation="required mobileNum" data-error-message="Mobile No is required"
                                                        placeholder="">
                                                    </div>
                                                </div>
												
												<div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">User Id*</label>
                                                        <input type="text" class="form-control input-style"
                                                        id="userId" name="userId" aria-describedby="emailHelp" data-validation="required" data-error-message="User Id is required"
                                                        placeholder="">
                                                    </div>
                                                </div>
												
												<div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label for="exampleInputEmail1" class="input__label">Password*</label>
                                                        <input type="text" class="form-control input-style"
                                                        id="password" name="password" aria-describedby="emailHelp" data-validation="required" data-error-message="Password is required"
                                                        placeholder="">
                                                    </div>
                                                </div>

                                                <div class="col-xl-3 col-xs-6 pr-xl-2">
                                                    <div class="form-group">
                                                        <label class="input__label">Rights*</label>
        
                                                                        <select class="form-control input-style" id="rights" name="rights">
                                                                            <option value="View Only">View Only</option>
                                                                            <option value="Doctor">Doctor</option>
                                                                            <option value="Admin">Admin</option>

                                                                        </select>
                                                    </div>
                                                </div>
                                                

                                            </div>
                                            <div class="text-right">
                                                <button type="button" onclick="updateQuery()" id="mod-btn" class="btn btn-primary btn-style mt-3 mr-3"><i class="fa-regular fa-pen-to-square"></i> Modify</button>
                                                <button type="button"  onclick=" window.location.href = '/staff'" class="btn btn-danger btn-style mt-3 mr-3"><i class="fas fa-times"></i> Cancel</button>
                                                <button type="submit" id="sub-btn" class="btn btn-primary btn-style mt-3"><i class="far fa-save"></i> Save</button>
                                            </div>

                                        </form>
                                    </div>

                                </div>
                            </div>
                            <!--part 1 ended-->

                        </div>
                    </div>
                </div>
                <!-- //charts -->
            </div>

<%- include('../footer') -%>

<script>
function updateRights() {
    // Collect all checked values
    const selectedRights = Array.from(document.querySelectorAll('.form-check-input:checked')).map(checkbox => checkbox.value);

    // Convert selected values to JSON string and set it as the input field's value
    document.getElementById('role').value = JSON.stringify(selectedRights);
}

    function updateQuery(){
document.getElementById('query').value=1;
$('#mod-btn').prop('disabled', true);   
$('input, select').prop('disabled', false);
$('#code').prop('readonly', true);
document.getElementById('sub-btn').disabled = false;
}

if('<%= data.id %>'!==''){
$('input, select').prop('disabled', true);
document.getElementById('sub-btn').disabled = true;
document.getElementById('mod-btn').disabled = false;
document.getElementById('code').value='<%=data.code%>'
document.getElementById('name').value='<%=data.name%>'
document.getElementById('email').value='<%=data.email%>'
document.getElementById('mobile').value='<%=data.mobile%>'
document.getElementById('userId').value='<%=data.userId%>'
document.getElementById('password').value='<%=data.password%>'
document.getElementById('role').value='<%=data.role%>'


}else{

document.getElementById('mod-btn').disabled = true;
}
</script>


<script>
    $(document).ready(function () {
        console.log("Document is ready");
        const formId = '#staffForm'
        $(formId).on('submit', function (event) {
            event.preventDefault();
            const { isValid, errorMessage ,formData} = validateForm(formId);
            const errorDivId = '#errordiv';

            if (isValid) {
                const url = '/saveStaff';
                const loadingDiv = '#loadingIndicator';
    

                saveForm(formData, errorDivId, url, loadingDiv);
            } else {
                $(errorDivId).removeClass('alert-success').addClass('alert-danger').text(errorMessage).show();
            }
        });

    });

    
    
    const loadDropdown = (url, elementId, key, selectedValue = null) => {
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error fetching data from ${url}`);
            }
            return response.json();
        })
        .then(data => {
            const dropdown = document.getElementById(elementId);
            dropdown.innerHTML = '<option value="">Select</option>'; // Clear existing options and add a default one
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item[key];
                dropdown.appendChild(option);
            });

            // Set the value after the dropdown has been populated
            if (selectedValue) {
                dropdown.value = selectedValue;
            }
        })
        .catch(error => console.error(`Error fetching ${elementId} details:`, error));
};

// Call the function for both dropdowns with the selected value
loadDropdown('/getClinics', 'clinicid', 'name', '');
</script>